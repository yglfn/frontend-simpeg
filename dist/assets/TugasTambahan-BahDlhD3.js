import{_ as ca,a as ma,b as l,e as t,n as H,t as r,h as _,v as F,f as O,G as pa,H as q,F as B,B as E,g as c,k as v,x as z,y as Q,T as Y,C as M,m as i,p as J,o,w as S,E as C}from"./index-CerEmezX.js";import{l as ga}from"./lodash-DuUh2JXe.js";const fa={class:"app-container"},ba={class:"content-wrapper"},ka={class:"modern-header"},ha={class:"header-actions"},ya=["disabled"],_a={class:"main-card"},Ca={class:"toolbar"},xa={class:"search-wrapper"},wa={class:"filter-wrapper"},Ma={class:"select-wrapper"},Pa=["value"],Da={key:0,class:"active-filters-bar"},Ta={key:0,class:"chip"},ja={key:1,class:"chip"},Ka={class:"table-wrapper"},Ua={key:0,class:"loading-overlay"},Fa={key:1,class:"state-container error"},Ba={key:2,class:"modern-table"},Ea={key:0},Na={class:"text-muted"},Va={class:"font-bold text-dark"},Ia={class:"badge badge-blue"},La={key:0,class:"small-note text-muted"},Sa={key:1,class:"text-muted"},$a={class:"date-cell"},Aa={class:"date-main"},Ga={class:"action-group"},Ra=["onClick"],Ha=["onClick"],Oa={key:1,class:"card-footer"},qa={class:"footer-info"},za={key:0,class:"pagination-modern"},Qa=["disabled"],Ya=["onClick"],Ja=["disabled"],Wa={class:"modal-header"},Xa={class:"modal-body"},Za={class:"form-group"},at={class:"form-group"},tt={class:"select-wrapper fluid"},et=["value"],st={class:"form-group"},nt={class:"form-actions-right"},lt=["disabled"],ot={key:0,class:"fas fa-spinner fa-spin"},rt={class:"modal-body"},ut={class:"modal-desc"},it={class:"form-group",style:{margin:"15px 0"}},dt={class:"d-block mb-2 text-muted small"},vt={class:"modal-actions-center"},ct=["disabled"],mt={__name:"TugasTambahan",setup(pt){const k=i(!1),x=i(""),p=i(""),g=i(""),P=i(!1),N=i(!1),D=i(!1),h=i(!1),T=i(!1),j=i(""),K=i([]),U=i([]),f=i(null),n=i({currentPage:1,perPage:10,total:0,lastPage:1,from:1,to:10}),m=i({nama_tugas:"",unit_kerja_id:"",keterangan:""}),$=J(()=>g.value||p.value),W=J(()=>{const s=[],{currentPage:a,lastPage:e}=n.value,d=1;for(let u=Math.max(2,a-d);u<=Math.min(e-1,a+d);u++)s.push(u);return a-d>2&&s.unshift("..."),a+d<e-1&&s.push("..."),s.unshift(1),e>1&&s.push(e),s.filter((u,y,va)=>va.indexOf(u)===y)}),X=s=>{const a=U.value.find(e=>e.id==s);return a?a.nama_unit:"..."},Z=async()=>{try{const s=await M.get("/super-admin/unit-kerja");U.value=s.data.data||[]}catch(s){console.error("Error fetching unit kerja:",s)}},b=async()=>{try{k.value=!0,x.value="";let a=(await M.get("/super-admin/tugas-tambahan")).data.data||[];if(p.value){const u=p.value.toLowerCase();a=a.filter(y=>y.nama_tugas.toLowerCase().includes(u)||y.keterangan&&y.keterangan.toLowerCase().includes(u))}g.value&&(a=a.filter(u=>u.unit_kerja_id==g.value)),n.value.total=a.length,n.value.lastPage=Math.ceil(a.length/n.value.perPage);const e=(n.value.currentPage-1)*n.value.perPage,d=e+n.value.perPage;K.value=a.slice(e,d),n.value.from=e+1,n.value.to=Math.min(d,n.value.total),n.value.total===0&&(n.value.from=0)}catch(s){console.error("Error fetching data:",s),x.value="Gagal memuat data."}finally{k.value=!1}},aa=async()=>{var s,a;try{h.value=!0,await M.post("/super-admin/tugas-tambahan",m.value),C.success("Berhasil menambahkan tugas tambahan"),w(),b()}catch(e){console.error("Create error:",e),C.error(((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Gagal menambahkan data")}finally{h.value=!1}},ta=async()=>{var s,a;try{h.value=!0,await M.put(`/super-admin/tugas-tambahan/${f.value.id}`,m.value),C.success("Berhasil memperbarui data"),w(),b()}catch(e){console.error("Update error:",e),C.error(((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Gagal memperbarui data")}finally{h.value=!1}},ea=async()=>{var s,a;try{T.value=!0,await M.delete(`/super-admin/tugas-tambahan/${f.value.id}`),C.success("Data berhasil dihapus"),L(),b()}catch(e){console.error("Delete error:",e),C.error(((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Gagal menghapus data")}finally{T.value=!1}},A=()=>{p.value="",g.value="",n.value.currentPage=1,b()},V=()=>{n.value.currentPage=1,b()},G=()=>{n.value.currentPage=1,b()},sa=()=>{A()},I=s=>{s!=="..."&&s>=1&&s<=n.value.lastPage&&(n.value.currentPage=s,b())},R=ga.debounce(()=>{V()},500),na=(s,a)=>s?s.length<=a?s:s.substring(0,a)+"...":"",la=s=>s?new Date(s).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-",oa=()=>{ia(),D.value=!1,P.value=!0},ra=s=>{f.value=s,D.value=!0,m.value={nama_tugas:s.nama_tugas,unit_kerja_id:s.unit_kerja_id,keterangan:s.keterangan||""},P.value=!0},ua=s=>{f.value=s,j.value="",N.value=!0},w=()=>{P.value=!1,f.value=null},L=()=>{N.value=!1,f.value=null},ia=()=>{m.value={nama_tugas:"",unit_kerja_id:"",keterangan:""}},da=()=>{D.value?ta():aa()};return ma(async()=>{await Z(),b()}),(s,a)=>(o(),l("div",fa,[t("div",ba,[t("header",ka,[a[14]||(a[14]=t("div",{class:"header-content"},[t("div",{class:"header-icon"},[t("i",{class:"fas fa-tasks"})]),t("div",{class:"header-text"},[t("h1",null,"Manajemen Tugas Tambahan"),t("p",null,"Kelola data tugas tambahan dan unit kerja terkait.")])],-1)),t("div",ha,[t("button",{class:"btn btn-secondary btn-icon-text",onClick:A,disabled:k.value},[t("i",{class:H(["fas fa-sync-alt",{"fa-spin":k.value}])},null,2),t("span",null,r(k.value?"Memuat...":"Refresh"),1)],8,ya),t("button",{class:"btn btn-primary btn-icon-text",onClick:oa},[...a[13]||(a[13]=[t("i",{class:"fas fa-plus"},null,-1),t("span",null,"Tugas Tambahan Baru",-1)])])])]),t("div",_a,[t("div",Ca,[t("div",xa,[a[15]||(a[15]=t("i",{class:"fas fa-search"},null,-1)),_(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),placeholder:"Cari nama tugas atau keterangan...",onKeyup:pa(V,["enter"]),onInput:a[1]||(a[1]=(...e)=>O(R)&&O(R)(...e))},null,544),[[F,p.value]])]),t("div",wa,[t("div",Ma,[_(t("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e),onChange:G},[a[16]||(a[16]=t("option",{value:"",disabled:"",selected:""},"Filter Unit Kerja",-1)),a[17]||(a[17]=t("option",{value:""},"Semua Unit Kerja",-1)),(o(!0),l(B,null,E(U.value,e=>(o(),l("option",{key:e.id,value:e.id},r(e.nama_unit),9,Pa))),128))],544),[[q,g.value]]),a[18]||(a[18]=t("i",{class:"fas fa-chevron-down dropdown-icon"},null,-1))]),$.value?(o(),l("button",{key:0,class:"btn-icon-only",onClick:sa,title:"Reset Filter"},[...a[19]||(a[19]=[t("i",{class:"fas fa-times"},null,-1)])])):c("",!0)])]),$.value?(o(),l("div",Da,[a[20]||(a[20]=t("span",{class:"filter-label"},"Filter Aktif:",-1)),g.value?(o(),l("span",Ta,[v(" Unit: "+r(X(g.value))+" ",1),t("i",{class:"fas fa-times",onClick:a[3]||(a[3]=e=>{g.value="",G()})})])):c("",!0),p.value?(o(),l("span",ja,[v(' "'+r(p.value)+'" ',1),t("i",{class:"fas fa-times",onClick:a[4]||(a[4]=e=>{p.value="",V()})})])):c("",!0)])):c("",!0),t("div",Ka,[k.value?(o(),l("div",Ua,[...a[21]||(a[21]=[t("div",{class:"spinner"},null,-1)])])):c("",!0),x.value?(o(),l("div",Fa,[a[22]||(a[22]=t("div",{class:"state-icon bg-red"},[t("i",{class:"fas fa-exclamation-triangle"})],-1)),a[23]||(a[23]=t("h3",null,"Gagal Memuat Data",-1)),t("p",null,r(x.value),1),t("button",{class:"btn btn-primary",onClick:b},"Coba Lagi")])):c("",!0),x.value?c("",!0):(o(),l("table",Ba,[a[27]||(a[27]=t("thead",null,[t("tr",null,[t("th",{width:"50"},"No"),t("th",null,"Nama Tugas"),t("th",null,"Unit Kerja"),t("th",null,"Keterangan"),t("th",null,"Terakhir Diubah"),t("th",{class:"text-right"},"Aksi")])],-1)),t("tbody",null,[!k.value&&K.value.length===0?(o(),l("tr",Ea,[...a[24]||(a[24]=[t("td",{colspan:"6"},[t("div",{class:"state-container empty"},[t("div",{class:"state-icon bg-blue"},[t("i",{class:"fas fa-inbox"})]),t("h3",null,"Data Kosong"),t("p",null,"Belum ada data tugas tambahan yang ditemukan.")])],-1)])])):(o(!0),l(B,{key:1},E(K.value,(e,d)=>(o(),l("tr",{key:e.id},[t("td",Na,r(n.value.from+d),1),t("td",null,[t("span",Va,r(e.nama_tugas),1)]),t("td",null,[t("span",Ia,r(e.unit_kerja_nama||"-"),1)]),t("td",null,[e.keterangan?(o(),l("span",La,r(na(e.keterangan,50)),1)):(o(),l("span",Sa,"-"))]),t("td",null,[t("div",$a,[t("span",Aa,r(la(e.updated_at||e.created_at)),1)])]),t("td",null,[t("div",Ga,[t("button",{class:"btn-action edit",onClick:u=>ra(e),title:"Edit"},[...a[25]||(a[25]=[t("i",{class:"fas fa-pen"},null,-1)])],8,Ra),t("button",{class:"btn-action delete",onClick:u=>ua(e),title:"Hapus"},[...a[26]||(a[26]=[t("i",{class:"fas fa-trash-alt"},null,-1)])],8,Ha)])])]))),128))])]))]),K.value.length>0?(o(),l("div",Oa,[t("div",qa,[a[28]||(a[28]=v(" Menampilkan ",-1)),t("b",null,r(n.value.from)+"-"+r(n.value.to),1),a[29]||(a[29]=v(" dari ",-1)),t("b",null,r(n.value.total),1),a[30]||(a[30]=v(" data ",-1))]),n.value.lastPage>1?(o(),l("div",za,[t("button",{class:"page-btn prev",disabled:n.value.currentPage===1,onClick:a[5]||(a[5]=e=>I(n.value.currentPage-1))},[...a[31]||(a[31]=[t("i",{class:"fas fa-chevron-left"},null,-1)])],8,Qa),(o(!0),l(B,null,E(W.value,e=>(o(),l("button",{key:e,class:H(["page-btn number",{active:e===n.value.currentPage,dots:e==="..."}]),onClick:d=>I(e)},r(e),11,Ya))),128)),t("button",{class:"page-btn next",disabled:n.value.currentPage===n.value.lastPage,onClick:a[6]||(a[6]=e=>I(n.value.currentPage+1))},[...a[32]||(a[32]=[t("i",{class:"fas fa-chevron-right"},null,-1)])],8,Ja)])):c("",!0)])):c("",!0)])]),z(Y,{name:"modal-fade"},{default:Q(()=>[P.value?(o(),l("div",{key:0,class:"modal-backdrop",onClick:w},[t("div",{class:"modal-card modal-md",onClick:a[10]||(a[10]=S(()=>{},["stop"]))},[t("div",Wa,[t("h2",null,r(D.value?"Edit Tugas Tambahan":"Tambah Tugas Tambahan"),1),t("button",{class:"btn-close",onClick:w},[...a[33]||(a[33]=[t("i",{class:"fas fa-times"},null,-1)])])]),t("div",Xa,[t("form",{onSubmit:S(da,["prevent"]),class:"modern-form"},[t("div",Za,[a[34]||(a[34]=t("label",{for:"nama_tugas"},[v("Nama Tugas Tambahan "),t("span",{class:"text-danger"},"*")],-1)),_(t("input",{type:"text",id:"nama_tugas","onUpdate:modelValue":a[7]||(a[7]=e=>m.value.nama_tugas=e),placeholder:"Contoh: Kepala Laboratorium",required:""},null,512),[[F,m.value.nama_tugas]])]),t("div",at,[a[37]||(a[37]=t("label",{for:"unit_kerja"},[v("Unit Kerja "),t("span",{class:"text-danger"},"*")],-1)),t("div",tt,[_(t("select",{id:"unit_kerja","onUpdate:modelValue":a[8]||(a[8]=e=>m.value.unit_kerja_id=e),required:""},[a[35]||(a[35]=t("option",{value:""},"Pilih Unit Kerja...",-1)),(o(!0),l(B,null,E(U.value,e=>(o(),l("option",{key:e.id,value:e.id},r(e.nama_unit),9,et))),128))],512),[[q,m.value.unit_kerja_id]]),a[36]||(a[36]=t("i",{class:"fas fa-chevron-down dropdown-icon"},null,-1))])]),t("div",st,[a[38]||(a[38]=t("label",{for:"keterangan"},"Keterangan",-1)),_(t("textarea",{id:"keterangan","onUpdate:modelValue":a[9]||(a[9]=e=>m.value.keterangan=e),rows:"3",placeholder:"Keterangan opsional..."},null,512),[[F,m.value.keterangan]])]),t("div",nt,[t("button",{type:"button",class:"btn btn-text",onClick:w},"Batal"),t("button",{type:"submit",class:"btn btn-primary",disabled:h.value},[h.value?(o(),l("i",ot)):c("",!0),v(" "+r(h.value?"Menyimpan...":"Simpan Data"),1)],8,lt)])],32)])])])):c("",!0)]),_:1}),z(Y,{name:"modal-fade"},{default:Q(()=>{var e,d,u;return[N.value?(o(),l("div",{key:0,class:"modal-backdrop",onClick:L},[t("div",{class:"modal-card modal-sm text-center",onClick:a[12]||(a[12]=S(()=>{},["stop"]))},[t("div",rt,[a[45]||(a[45]=t("div",{class:"warning-icon"},[t("i",{class:"fas fa-trash"})],-1)),a[46]||(a[46]=t("h3",null,"Hapus Data?",-1)),t("p",ut,[a[39]||(a[39]=v(" Anda akan menghapus tugas tambahan ",-1)),t("strong",null,r((e=f.value)==null?void 0:e.nama_tugas),1),a[40]||(a[40]=v(". Tindakan ini ",-1)),a[41]||(a[41]=t("strong",null,"tidak dapat dibatalkan",-1)),a[42]||(a[42]=v(". ",-1))]),t("div",it,[t("label",dt,[a[43]||(a[43]=v("Ketik ",-1)),t("strong",null,r(((d=f.value)==null?void 0:d.nama_tugas)||"KONFIRMASI"),1),a[44]||(a[44]=v(" untuk melanjutkan:",-1))]),_(t("input",{type:"text","onUpdate:modelValue":a[11]||(a[11]=y=>j.value=y),class:"form-control text-center",placeholder:"Ketik disini...",style:{width:"100%",padding:"8px",border:"1px solid #ddd","border-radius":"6px"}},null,512),[[F,j.value]])]),t("div",vt,[t("button",{class:"btn btn-secondary",onClick:L},"Batal"),t("button",{class:"btn btn-danger",onClick:ea,disabled:T.value||j.value!==(((u=f.value)==null?void 0:u.nama_tugas)||"KONFIRMASI")},r(T.value?"Menghapus...":"Ya, Hapus"),9,ct)])])])])):c("",!0)]}),_:1})]))}},bt=ca(mt,[["__scopeId","data-v-1eb37533"]]);export{bt as default};
